(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx","exports"],function(b,d){return c.Rx=a(c,d,b),c.Rx}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("./rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(a,b,c){return new r(function(d){var e=!1,f=null,g=[];return a.subscribe(function(a){var h,i;try{i=b(a)}catch(j){return void d.onError(j)}if(h=0,e)try{h=c(i,f)}catch(k){return void d.onError(k)}else e=!0,f=i;h>0&&(f=i,g=[]),h>=0&&g.push(a)},d.onError.bind(d),function(){d.onNext(g),d.onCompleted()})})}function f(a){if(0===a.length)throw new Error(A);return a[0]}function g(a,b,c){return new r(function(d){var e=0,f=b.length;return a.subscribe(function(a){var g=!1;try{f>e&&(g=c(a,b[e++]))}catch(h){return void d.onError(h)}g||(d.onNext(!1),d.onCompleted())},d.onError.bind(d),function(){d.onNext(e===f),d.onCompleted()})})}function h(a,b,c,d){if(0>b)throw new Error(z);return new r(function(e){var f=b;return a.subscribe(function(a){0===f&&(e.onNext(a),e.onCompleted()),f--},e.onError.bind(e),function(){c?(e.onNext(d),e.onCompleted()):e.onError(new Error(z))})})}function i(a,b,c){return new r(function(d){var e=c,f=!1;return a.subscribe(function(a){f?d.onError(new Error("Sequence contains more than one element")):(e=a,f=!0)},d.onError.bind(d),function(){f||b?(d.onNext(e),d.onCompleted()):d.onError(new Error(A))})})}function j(a,b,c){return new r(function(d){return a.subscribe(function(a){d.onNext(a),d.onCompleted()},d.onError.bind(d),function(){b?(d.onNext(c),d.onCompleted()):d.onError(new Error(A))})})}function k(a,b,c){return new r(function(d){var e=c,f=!1;return a.subscribe(function(a){e=a,f=!0},d.onError.bind(d),function(){f||b?(d.onNext(e),d.onCompleted()):d.onError(new Error(A))})})}function l(a,b,c,e){return new r(function(f){var g=0;return a.subscribe(function(d){var h;try{h=b.call(c,d,g,a)}catch(i){return void f.onError(i)}h?(f.onNext(e?g:d),f.onCompleted()):g++},f.onError.bind(f),function(){f.onNext(e?-1:d),f.onCompleted()})})}function m(a,b){return new r(function(c){var d=new b;return a.subscribe(d.add.bind(d),c.onError.bind(c),function(){c.onNext(d),c.onCompleted()})})}function n(a,b,c,d){return new r(function(e){var f=new b;return a.subscribe(function(a){var b;try{b=c(a)}catch(g){return void e.onError(g)}var h=a;if(d)try{h=d(a)}catch(g){return void e.onError(g)}f.set(b,h)},e.onError.bind(e),function(){e.onNext(f),e.onCompleted()})})}var o=c.Observable,p=o.prototype,q=c.CompositeDisposable,r=c.AnonymousObservable,s=(c.internals.isEqual,c.helpers),t=s.not,u=s.defaultComparer,v=s.identity,w=s.defaultSubComparer,x=s.isPromise,y=o.fromPromise,z="Argument out of range",A="Sequence contains no elements.";return p.finalValue=function(){var a=this;return new r(function(b){var c,d=!1;return a.subscribe(function(a){d=!0,c=a},b.onError.bind(b),function(){d?(b.onNext(c),b.onCompleted()):b.onError(new Error(A))})})},p.aggregate=function(){var a,b,c;return 2===arguments.length?(a=arguments[0],b=!0,c=arguments[1]):c=arguments[0],b?this.scan(a,c).startWith(a).finalValue():this.scan(c).finalValue()},p.reduce=function(a){var b,c;return 2===arguments.length&&(c=!0,b=arguments[1]),c?this.scan(b,a).startWith(b).finalValue():this.scan(a).finalValue()},p.some=p.any=function(a,b){var c=this;return a?c.where(a,b).any():new r(function(a){return c.subscribe(function(){a.onNext(!0),a.onCompleted()},a.onError.bind(a),function(){a.onNext(!1),a.onCompleted()})})},p.isEmpty=function(){return this.any().map(t)},p.every=p.all=function(a,b){return this.where(function(b){return!a(b)},b).any().select(function(a){return!a})},p.contains=function(a,b){return b||(b=u),this.where(function(c){return b(c,a)}).any()},p.count=function(a,b){return a?this.where(a,b).count():this.aggregate(0,function(a){return a+1})},p.sum=function(a,b){return a?this.select(a,b).sum():this.aggregate(0,function(a,b){return a+b})},p.minBy=function(a,b){return b||(b=w),e(this,a,function(a,c){return-1*b(a,c)})},p.min=function(a){return this.minBy(v,a).select(function(a){return f(a)})},p.maxBy=function(a,b){return b||(b=w),e(this,a,b)},p.max=function(a){return this.maxBy(v,a).select(function(a){return f(a)})},p.average=function(a,b){return a?this.select(a,b).average():this.scan({sum:0,count:0},function(a,b){return{sum:a.sum+b,count:a.count+1}}).finalValue().select(function(a){if(0===a.count)throw new Error("The input sequence was empty");return a.sum/a.count})},p.sequenceEqual=function(a,b){var c=this;return b||(b=u),Array.isArray(a)?g(c,a,b):new r(function(d){var e=!1,f=!1,g=[],h=[],i=c.subscribe(function(a){var c,e;if(h.length>0){e=h.shift();try{c=b(e,a)}catch(i){return void d.onError(i)}c||(d.onNext(!1),d.onCompleted())}else f?(d.onNext(!1),d.onCompleted()):g.push(a)},d.onError.bind(d),function(){e=!0,0===g.length&&(h.length>0?(d.onNext(!1),d.onCompleted()):f&&(d.onNext(!0),d.onCompleted()))});x(a)&&(a=y(a));var j=a.subscribe(function(a){var c,f;if(g.length>0){f=g.shift();try{c=b(f,a)}catch(i){return void d.onError(i)}c||(d.onNext(!1),d.onCompleted())}else e?(d.onNext(!1),d.onCompleted()):h.push(a)},d.onError.bind(d),function(){f=!0,0===h.length&&(g.length>0?(d.onNext(!1),d.onCompleted()):e&&(d.onNext(!0),d.onCompleted()))});return new q(i,j)})},p.elementAt=function(a){return h(this,a,!1)},p.elementAtOrDefault=function(a,b){return h(this,a,!0,b)},p.single=function(a,b){return a?this.where(a,b).single():i(this,!1)},p.singleOrDefault=function(a,b,c){return a?this.where(a,c).singleOrDefault(null,b):i(this,!0,b)},p.first=function(a,b){return a?this.where(a,b).first():j(this,!1)},p.firstOrDefault=function(a,b){return a?this.where(a).firstOrDefault(null,b):j(this,!0,b)},p.last=function(a,b){return a?this.where(a,b).last():k(this,!1)},p.lastOrDefault=function(a,b,c){return a?this.where(a,c).lastOrDefault(null,b):k(this,!0,b)},p.find=function(a,b){return l(this,a,b,!1)},p.findIndex=function(a,b){return l(this,a,b,!0)},a.Set&&(p.toSet=function(){return m(this,a.Set)}),a.WeakSet&&(p.toWeakSet=function(){return m(this,a.WeakSet)}),a.Map&&(p.toMap=function(b,c){return n(this,a.Map,b,c)}),a.WeakMap&&(p.toWeakMap=function(b,c){return n(this,a.WeakMap,b,c)}),c});