/*! ng-roundabout by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-09-24 */
!function(a,b,c){"use strict";var d=a.module("ngRoundabout",[]).run(function(){a.isDefined(c)&&c.addTest("preserve3d",c.testAllProps("transformStyle","preserve-3d"))});d.constant("roundaboutOptions",{DIMENSION_WIDTH:250,DIMENSION_HEIGHT:300,DIMENSION_SPACING:10,PERSPECTIVE:1e3,TRANSLATE_Z:-2e3,BACKFACE_VISIBILITY:"hidden",MAINTAIN_ASPECT_RATIO:!1,FIGURE_PARTIAL_PATH:"partials/roundabout.html"}),d.directive("roundabout",["$window","roundaboutOptions",function(d,e){return{restrict:"EA",require:"ngModel",template:'<section class="roundabout-container"><figure ng-repeat="model in collection" ng-include="partial">{{applyFigureElementStyles($index)}}</figure></section>',scope:{collection:"=ngModel",dimension:"=dimension"},controller:["$scope",function(b){b.currentDimensionWidth=0,b.memorisedOptions=!1,b.originalCount=0,b.partial=e.FIGURE_PARTIAL_PATH,b.applyBaseElementStyles=function(a){return a.css({width:e.DIMENSION_WIDTH+"px",height:e.DIMENSION_HEIGHT+"px",display:"block",position:"relative",perspective:e.PERSPECTIVE+"px"})},b.applyContainerElementStyles=function(a,b){return b=null!==e.TRANSLATE_Z?e.TRANSLATE_Z:b,a.css({width:"100%",height:"100%",position:"absolute",transform:"translateZ("+b+"px) rotateY(0deg)",transformStyle:"preserve-3d"})},b.applyFigureElementStyles=function(c,d){d=!!d||!1;var f=a.element(b.baseElement.find("figure")[c]),g=b.dimensionDegree*c;return f.css({width:b.currentDimensionWidth-e.DIMENSION_SPACING+"px",height:e.DIMENSION_HEIGHT+"px",display:"block",position:"absolute",transform:"rotateY("+g+"deg) translateZ("+b.translateZ+"px)",backfaceVisibility:e.BACKFACE_VISIBILITY}),d?f:void 0},b.supports3DTransforms=function(){return a.isDefined(c)?c.preserve3d:null},b.applyContainerElementOffset=function(a){a.css({left:"-"+(b.currentDimensionWidth-e.DIMENSION_WIDTH)/2+"px"})}}],link:function(c,d){c.currentDimensionWidth=e.DIMENSION_WIDTH,c.$watch("dimension",function(){var b=c.dimensionDegree*c.dimension;if(a.isNumber(b)){var f=a.element(d.find("section")[0]),g=null!==e.TRANSLATE_Z?e.TRANSLATE_Z:0;f.css({transform:"translateZ("+g+"px) rotateY("+b+"deg)"})}}),c.$watchCollection("collection",function(){if(0!==c.collection.length){var f=a.element(d.find("section")[0]),g=c.collection.length,h=360/g,i=e.DIMENSION_WIDTH/2,j=b.round(i/b.tan(b.PI/g));c.translateZ=j,c.baseElement=d,c.dimensionDegree=h,c.memorisedOptions||(c.originalCount=c.collection.length,c.originalTranslateZ=j,c.memorisedOptions=!0),c.applyBaseElementStyles(d),c.applyContainerElementStyles(f,j),e.MAINTAIN_ASPECT_RATIO&&(c.translateZ=c.originalTranslateZ,c.currentDimensionWidth=e.DIMENSION_WIDTH*c.originalCount/g,c.applyContainerElementOffset(f))}})}}}])}(window.angular,window.Math,window.Modernizr);